# ========================================
# MySQL 9.4.0 Windows 11 高性能配置文件
# 32GB内存环境优化版本
# @author: Mr.Rey Copyright © 2025
# @created: 2025-06-28 15:30:00
# @modified: 2025-01-28 16:30:00
# @version: 1.1.0
# ========================================

[mysqld]
# ========================================
# 基础网络配置
# ========================================
# 绑定地址 - 仅允许本地连接，提高安全性
bind-address=127.0.0.1
# 端口规范：MySQL统一使用 8906（项目端口范围 8901-8910）
port=8906

# ========================================
# 目录配置 - 使用绝对路径
# ========================================
# 基础目录 - 使用项目绝对路径
basedir=D:/honyrun_mv20251013/HonyRun/backend/mysql/windows/server
# 数据目录 - 使用绝对路径
datadir=d:/honyrun_mv20251013/HonyRun/backend/mysql/windows/data
# 临时目录 - 使用绝对路径
tmpdir=d:/honyrun_mv20251013/HonyRun/backend/mysql/windows/temp
# 套接字文件（Windows下使用命名管道）
socket=mysql.sock

# ========================================
# 字符集和排序规则配置
# ========================================
# 服务器字符集 - 统一使用UTF-8
character-set-server=utf8mb4
# 服务器排序规则
collation-server=utf8mb4_general_ci
# 初始化连接字符集
init_connect='SET NAMES utf8mb4'

# ========================================
# SQL模式和兼容性配置
# ========================================
# SQL模式 - MySQL 9.4.0兼容设置，移除已弃用的模式
sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION,ONLY_FULL_GROUP_BY
# 时间戳默认值
explicit_defaults_for_timestamp=ON
# 大小写敏感性（Windows下设置为1）
lower_case_table_names=1

# ========================================
# 32GB内存环境 - InnoDB性能优化配置
# ========================================
# InnoDB缓冲池大小 - 32GB内存环境设置为16GB（50%内存）
innodb_buffer_pool_size=16G
# InnoDB缓冲池实例数 - 多实例提高并发性能
innodb_buffer_pool_instances=16
# InnoDB重做日志容量 - MySQL 9.4.0使用新参数替代innodb_log_file_size
innodb_redo_log_capacity=2G
# InnoDB日志缓冲区大小 - 大缓冲区减少磁盘I/O
innodb_log_buffer_size=256M
# InnoDB刷新方法 - Windows下使用默认方法
innodb_flush_method=normal
# InnoDB事务提交时刷新日志 - 1为最安全
innodb_flush_log_at_trx_commit=1
# InnoDB页面刷新邻接页面 - 0关闭以提高SSD性能
innodb_flush_neighbors=0

# ========================================
# InnoDB并发和锁配置
# ========================================
# InnoDB并发线程数 - 32GB环境设置为32
innodb_thread_concurrency=32
# InnoDB读I/O线程数 - 提高读取性能
innodb_read_io_threads=16
# InnoDB写I/O线程数 - 提高写入性能
innodb_write_io_threads=16
# InnoDB锁等待超时时间 - 50秒
innodb_lock_wait_timeout=50

# ========================================
# 连接和线程配置
# ========================================
# 最大连接数 - 32GB环境支持更多连接
max_connections=1000
# 最大用户连接数
max_user_connections=950
# 连接超时时间 - 28800秒（8小时）
wait_timeout=28800
# 交互式连接超时时间
interactive_timeout=28800
# 线程缓存大小 - 减少线程创建开销
thread_cache_size=100

# ========================================
# 查询缓存配置（MySQL 8.0已移除，保留注释）
# ========================================
# MySQL 8.0不再支持查询缓存，使用应用层缓存替代

# ========================================
# 表和索引缓存配置
# ========================================
# 表打开缓存 - 32GB环境增大缓存
table_open_cache=4000
# 表定义缓存
table_definition_cache=2000
# 打开文件限制
open_files_limit=65535

# ========================================
# 排序和临时表配置
# ========================================
# 排序缓冲区大小 - 32GB环境增大缓冲区
sort_buffer_size=16M
# 连接缓冲区大小
join_buffer_size=16M
# 临时表最大大小
tmp_table_size=512M
# 最大堆表大小
max_heap_table_size=512M

# ========================================
# MyISAM配置（主要用于系统表）
# ========================================
# MyISAM键缓冲区大小
key_buffer_size=256M
# MyISAM排序缓冲区大小
myisam_sort_buffer_size=128M

# ========================================
# 日志配置
# ========================================
# 错误日志文件 - 使用绝对路径
log_error=d:/honyrun_mv20251013/HonyRun/backend/mysql/windows/logs/error.log
# 慢查询日志
slow_query_log=ON
slow_query_log_file=d:/honyrun_mv20251013/HonyRun/backend/mysql/windows/logs/slow.log
# 慢查询时间阈值 - 2秒
long_query_time=2
# 记录未使用索引的查询
log_queries_not_using_indexes=ON

# 二进制日志配置 - 使用绝对路径
log_bin=d:/honyrun_mv20251013/HonyRun/backend/mysql/windows/logs/mysql-bin
# 二进制日志格式 - MySQL 9.4.0中binlog_format已弃用，使用默认设置
# binlog_format=ROW
# 二进制日志过期时间 - MySQL 9.4.0使用新参数（7天 = 604800秒）
binlog_expire_logs_seconds=604800
# 二进制日志最大大小
max_binlog_size=1G

# ========================================
# 安全配置
# ========================================
# 跳过域名解析 - 提高连接速度
skip_name_resolve=ON
# 跳过外部锁定
skip_external_locking=ON

# ========================================
# 性能监控配置
# ========================================
# 性能模式 - 启用性能监控
performance_schema=ON
# 性能模式内存使用限制
performance_schema_max_table_instances=12500
performance_schema_max_table_handles=4000

# ========================================
# Windows特定配置
# ========================================
# 命名管道支持
enable_named_pipe=ON
# 共享内存支持
shared_memory=ON
# 共享内存基础名称
shared_memory_base_name=MYSQL

[mysql]
# ========================================
# MySQL客户端配置
# ========================================
# 默认字符集
default-character-set=utf8mb4
# 自动重连
auto-rehash

[client]
# ========================================
# 通用客户端配置
# ========================================
# 默认字符集
default-character-set=utf8mb4
# 端口
port=8906
# 套接字
socket=mysql.sock

[mysqldump]
# ========================================
# mysqldump配置
# ========================================
# 单事务导出
single-transaction
# 锁定所有表
lock-all-tables
# 快速导出
quick
# 最大允许包大小
max_allowed_packet=1G

[mysqladmin]
# ========================================
# mysqladmin配置
# ========================================
# 强制执行
force

[myisamchk]
# ========================================
# MyISAM检查工具配置
# ========================================
# 键缓冲区大小
key_buffer_size=256M
# 排序缓冲区大小
sort_buffer_size=256M
# 读缓冲区大小
read_buffer=8M
# 写缓冲区大小
write_buffer=8M

